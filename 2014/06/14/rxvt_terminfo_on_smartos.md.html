
<!-- HTML generated by smallblog <https://github.com/abyxcos/smallblog> -->
<!DOCTYPE html>
<html>
	<head>
		<title>blog</title>
		<link rel="stylesheet" href="/blog/main.css">
		<link rel="stylesheet" href="main.css">
	</head>
	<body>
		<div class="container">
			<div class="site">
				<div class="header">
					<h1 class="title"><a href="/blog">mnetic.ch/blog</a></h1>
					<a class="extra" href="/blog/tags/">tags</a>
					<a class="extra" href="/blog/archive.html">all posts</a>
					<a class="extra" href="/blog/feed.rss">rss</a>
				</div> 
		<h2 class="title"><a href='/blog/2014/06/14/rxvt_terminfo_on_smartos.md.html'>
		How to make your server happy while using rxvt
		</a></h2>
		<p class="meta">Date: 2014-06-14 16:49:36 +0000</p>
		<div class="post">
<p>This one is for all of you <a href="http://en.wikipedia.org/wiki/Rxvt-unicode">rxvt</a> fans out there. I&rsquo;m sure many a time you have logged into some strange or new machine and been greeted by</p>

<pre><code>$ tmux
open terminal failed: missing or unsuitable terminal: rxvt-unicode-256color
</code></pre>

<p>And I&rsquo;m sure just as many of you have solved it with a quick</p>

<pre><code>$ export TERM=xterm
</code></pre>

<p>and been on your way. I finally got tired of this and decided to fix it. This post is targeted at <a href="http://smartos.org/">SmartOS</a>, as it&rsquo;s use of a segregated <a href="http://www.pkgsrc.org/">pkgsrc</a> userland is fairly unique, although shared by <a href="http://brew.sh/">Mac OSX</a>. These missing terminal definitions also occur on Debian and <a href="http://mail-index.netbsd.org/netbsd-users/2014/05/31/msg014665.html">NetBSD</a>.</p>

<p>This problem occurs when you install a new terminal emulator to your local computer, now your servers don&rsquo;t know what capabilities it has. Servers have a much smaller database of popular terminals that generally includes xterm, but not rxvt and friends. If your server already has X installed, you can simply install your favorite terminal there and benefit from pre-packaged terminfo files. Most servers don&rsquo;t have X installed so we need to inform our server about our new terminal.</p>

<p>Unfortunately, terminfo entries are stored as binary, so we need to decompile them before passing them over to the server. On your host machine, <a href="http://linux.die.net/man/1/infocmp"><code>infocmp(1)</code></a> will handle this. If, like me, you only care about a single entry, <code>rxvt-unicode-256color</code>, then</p>

<pre><code>$ infocmp -I rxvt-unicode-256color &gt; rxvt-unicode-256color.terminfo
</code></pre>

<p>and <a href="http://linux.die.net/man/1/scp"><code>scp(1)</code></a>ing the resulting file to your server will do the trick. If you want more, just continue feeding <a href="http://linux.die.net/man/1/infocmp"><code>infocmp(1)</code></a> more names. If you&rsquo;re not sure of the exact names, the terminfo files are likely located under <code>/usr/share/terminfo/*/*</code> alphabetically on a Linux machine.</p>

<p>Now we need to compile and install the file on our server. On Linux and BSD, this is simple and handled by <a href="http://linux.die.net/man/1/tic"><code>tic(1)</code></a>. To install for all users,</p>

<pre><code>$ sudo tic -s rxvt-unicode-256color.terminfo
</code></pre>

<p>or for just the local user,</p>

<pre><code>$ tic -s -o ~/.terminfo rxvt-unicode-256color.terminfo
</code></pre>

<p>If your terminfo files still aren&rsquo;t being found, you may need to set <code>$TERMINFO</code> to point to the installed path,</p>

<pre><code>$ export TERMINFO=~/.terminfo
</code></pre>

<p>SmartOS is a bit more complicated, due to the separate userlands. There are two <code>tic(1m)</code>&rsquo;s, the system <code>tic(1m)</code> at <code>/usr/bin/tic</code>, and the pkgsrc <code>tic(1m)</code> at <code>/opt/local/bin/tic</code>. I was not able to locate the man pages online, but you may note the difference in</p>

<pre><code>$ MANPATH=/usr/man man -s 1m tic # system manpages
$ MANPATH=/opt/local/man man -s 1 tic # pkgsrc manpages
</code></pre>

<p>If you <a href="http://www.illumos.org/man/1/ldd"><code>ldd(1)</code></a> the pkgsrc tmux,</p>

<pre><code>$ ldd /opt/local/bin/tmux
</code></pre>

<p>and look for curses, you will see that it&rsquo;s linked against <code>libcurses.so.1</code>, which is living in <code>/lib</code>. This means that <code>tmux</code> will default to looking in the system directory, <code>/usr/share/lib/terminfo</code>, which on SmartOS is read only. In this case, you <em>will</em> need to set <code>$TERMINFO</code> to ensure that your path is being found, as the system <code>tic(1m)</code> doesn&rsquo;t include <code>~/.terminfo</code> in it&rsquo;s default path like linux does. For a system install,</p>

<pre><code>$ sudo /opt/local/bin/tic -s rxvt-unicode-256color.terminfo
$ export TERMINFO=/opt/local/share/lib/terminfo
</code></pre>

<p>or a local install,</p>

<pre><code>$ tic -s -o ~/.terminfo rxvt-unicode-256color.terminfo
$ export TERMINFO=~/.terminfo
</code></pre>

<p>and now <code>tmux</code> should work.</p>

<p class="meta">tags: rxvt smartos solaris bsd linux tmux</p>
<br /></div> 
				<div class="footer">
					<div class="contact">
						<p>
							Aaron Fineman<br />
							github:
						</p>
					</div>
					<div class="contact">
						<p>
							<a href="mailto:abyxcos@mnetic.ch">abyxcos@mnetic.ch</a><br />
							<a href="https://github.com/abyxcos/">https://github.com/abyxcos/</a>
						</p>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
